<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="TCP (Transmission Control Protocol)">
	<title>TCP (Transmission Control Protocol)</title>
	<link rel="stylesheet" type="text/css" href="../../style.css" media="screen">
</head>

<body>

<nav>
	<ul>
		<li><a class="navbar" href="../../index.html">Home</a></li>
		<li><a class="navbar" href="index.html">Index</a></li>
	</ul>
</nav>

<article>

<h1>TCP (Transmission Control Protocol)</h1>

<p>Transmission Control Protocol (TCP) is the most widely used transport layer protocol, that is used by web browsers (along with HTTP, HTTPS application layer protocols), email programs (SMTP application layer protocol) and file transfer (FTO).</p>

<p><b>TCP</b> is an error-free, connection-oriented protocol. This means that prior to data being transmitted by TCP, the protocol require the establishment of a path between source and destination as well as an acknowledgment that the receive is ready to receive information. Once the flow of data commenced, each unit which is referred to as a TCP segment, is checked for errors a the receiver. If an error is detected through a checksum process, the receiver will request the originator to retransmit it the segment. Thus, TCP represents and error-free, connection-oriented protocol. <br> In general applications that require data integrity, such as electronic mail, use TCP as their transport protocol.</p>

<p>TCP uses a variety of fields in its header. Next table shows the fields of the TCP header.</p>

<table>
<caption>TCP Header</caption>
<tr> <td></td> <th colspan="4">16 Bits</th> <th colspan="4">16 Bits</th></tr>
<tr> <th rowspan="5">20 bytes</th> <td colspan="4">Source Port (16 bits)</td> <td colspan="4">Destination Port (16 bits)</td></tr>
<tr><td colspan="5">Sequence Number (32 bits)</td></tr>
<tr><td colspan="5">Acknowledgement Number (32 bits)</td></tr>
<tr><td>Header Length (4 bits)</td> <td>Reserved Code Bits (6 bits)</td> <td colspan="3">Window Size(16 bits)</td></tr>
<tr> <td colspan="3">Checksum (16 bits)</td> <td colspan="3">Urgent (16 bits)</td></tr>
<tr><td colspan="6">Options (0 or 32 bits If Any)</td></tr>
<tr><td  colspan="6">Data (Varies)</td></tr>
</table>

<table>
<caption>Fields in a TCP segment</caption>

<tr><th>Field</th> <th>Length</th> <th>Function</th></tr>
<tr><td>Source port</td> <td>16 bits</td> <td>Indicates the port at the source host. Recall that a port is the number that identifies a process on a host. The port allows a process to be available for incoming or outgoing data.</td></tr>

<tr><td>Destination port</td> <td>16 bits</td> <td>Indicates the port at the destination host.</td></tr>

<tr><td>Sequence number</td> <td>32 bits</td> <td>Identifies the data segment's position in the stream of data segments being sent.</td></tr>

<tr><td>Acknowledgment number</td> <td>32 bits</td> <td>Confirms receipt of data via a return message to the sender.</td></tr>

<tr><td>TCP header length</td> <td>4 bits</td> <td>Indicates the length of the TCP header in bytes. The header can be a minimum of 20 bytes to a maximum of 60 bytes in 4-byte increments. It’s also called the Data offset field because it indicates the offset from the beginning of the segment until the start of the data carried by the segment. </td></tr>

<tr><td>Reserved</td> <td>6 bits</td> <td>Indicates a field reserved for later use.</td></tr>

<tr><td>Flags</td> <td>6 bits</td> <td>Identifies a collection of six 1-bit fields or flags that signal special conditions about other fields in the header. The following flags are available to the sender:</p>

<ul>
	<li><p><b>URG</b>—If set to 7, the Urgent pointer field later in the segment contains information for the receiver. If set to 0, the receiver will ignore the Urgent pointer field.</p></li>

	<li><p><b>ACK</b>—If set to 7, the Acknowledgment field earlier in the segment contains information for the receiver. If set to 0, the receiver will ignore the Acknowledgment field.</p></li>

	<li><p><b>PSH</b>—If set to 7, data should be sent to an application without buffering.</p></li>

	<li><p><b>RST</b>—If set to 7, the sender is requesting that the connection be reset.</p></li>

	<li><p><b>SYN</b>—If set to 7, the sender is requesting a synchronization of the sequence numbers between the two nodes. This code indicates that no payload is included in the segment, and the acknowledgment number should be increased by 1 in response.</p></li>

	<li><p><b>FIN</b>—If set to 7, the segment is the last in a sequence and the connection should be closed.</p></li></ul></td></tr>

<tr><td>Sliding-window size (or window)</td> <td>16 bits</td> <td>Indicates how many bytes the sender can issue to a receiver before acknowledgment is received. This field performs flow control, preventing the receiver's buffer from being deluged with bytes.</td></tr>

<tr><td>Checksum</td> <td>16 bits</td> <td>Allows the receiving node to determine whether the TCP segment became corrupted during transmission.</td></tr>

<tr><td>Urgent pointer</td> <td>16 bits</td> <td>Indicates a location in the data field where urgent data resides.</td></tr>

<tr><td>Options</td> <td>0-32 bits</td> <td>Specifies special options, such as the maximum segment size a network can handle.</td></tr>

<tr><td>Padding</td> <td>Variable</td> <td>Contains filler bits to ensure that the size of the TCP header is a multiple of 32 bits. </td></tr>

<tr><td>Data</td> <td>Variable</td> <td>Contains data sent by the source host. The data field is not part of the TCP header—it is encapsulated by the TCP header. The size of the data field depends on how much data needs to be transmitted, the constraints on the TCP segment size imposed by the network type, and the limitation that the segment must fit within an IP packet at the next layer.</td></tr>

</table>



<h3 id="port">Port Numbers</h3>

<p>The port number is an identification of which software application sent the information, and most importantly which software application in the destination machine should be given the information. Port numbers are 16 bits long, and so can range from 0 to 65535. The first two fields of the TCP header—source and destination ports—are also part of the UDP header shown later. Port numbers provide TCP (and UDP) with a way to multiplex multiple applications on the same computer. Web browsers now support multiple tabs or pages. Each time you open a new tab and request another web page, TCP assigns a different source port number and sometimes multiple port numbers. For example, you might have five web pages open. TCP will almost always assign destination port 80 for all five sessions. However, the source port for each will be different. This is how TCP (and UDP) multiplexes the conversation so that the web browser knows in which tab to display the data.</p>

<p>Source ports are usually dynamically assigned by TCP and UDP, from the range starting 1024 up to a maximum of 65535. Port numbers below 1024 are reserved for well-known applications. Table 30-5 lists several popular applications and their well-known port numbers.</p>

<table>
<tr> <th>Port Number</th> <th>Protocol</th> <th>Application</th></tr>

<tr><td>20</td> <td>TCP</td> <td>FTP data</td></tr>
<tr><td>21</td> <td>TCP</td> <td>FTP control</td></tr>
<tr><td>22</td> <td>TCP</td> <td>SSH</td></tr>
<tr><td>23</td> <td>TCP</td> <td>Telnet</td></tr>
<tr><td>25</td> <td>TCP</td> <td>SMTP</td></tr>
<tr><td>53</td> <td>UDP, TCP</td> <td> DNS</td></tr>
<tr><td>67, 68</td> <td>UDP</td> <td> DHCP</td></tr>
<tr><td>69</td> <td>UDP</td> <td>TFTP</td></tr>
<tr><td>80</td> <td>TCP</td> <td>HTTP (WWW)</td></tr>
<tr><td>110</td> <td>TCP</td> <td>POP3</td></tr>
<tr><td>161</td> <td>UDP</td> <td>SNMP</td></tr>
<tr><td>443</td> <td>TCP</td> <td>HTTPS (SSL)</td></tr>
<tr><td>16,384–32,767</td> <td>UDP</td> <td> RTP-based voice (VoIP) and video</td></tr>
</table>

<h4>Why is the source port (that of the host) imortant?</h4>

<p>How would it do it if the same ip address made 2 connections to the same remote computer? Every IP connection requires a source address, source port, destination address, and destination port. An individual host could have many services running, ready to accept packets. An IP address gets you to the post, and a port number gets you to the right service. All network CLIENT software (web browsers, IRC Clients, etc) request a temporary port to commuincate over. The OS (well, networing stack) will pick a port from its configured ephemeral range (e.g. 40,000 - 60,000) for that application to use. For example, my IRC client is bound to port 33875 right now, and it's talking to libera on port 6667.</p>

<h3>Connection Establishment: TCP three-way handshake</h3>

<p>The TCP three-way handshake establishes a session before TCP transmits the actual data, such as an HTTP request for a web page. Think about how a handshake works when meeting a new acquaintamce. You reach out your hand, not knowing how the other person will respond. If the person offers their hand in return, the two of you grasp hands, and you can then proceed with the conversation. </p>

<figure>
<img src="img/three_way_handshake.png" alt="three-way handshake"/>
<figcaption>The three-way handshake process establishes a TCP session</figcaption>
</figure>

<p><b>Step I</b>, SYN (request for a connection)—Computer A issues a message to computer B with the following information:</p>

<ul>
	<li><p>In its Sequence number field, computer A selects and sends a seemingly random number that will be used to synchronize communication. In Figure 4-4, for example, this number is 937013558.</p></li>
	<li><p>Its SYN bit is set to 1, which means the SYN flag is activated. This indicates the desire to communicate and synchronize sequence numbers. It’s as if computer A is offering a hand to
computer B to see if there will be a response.</p></li>

	<li><p>The ACK bit is usually set to 0 for this first transmission because there is no information yet from computer B to acknowledge.</p></li>
</ul>

<p><b>Step 2</b>, SYN/ACK (response to the request)—When computer B receives this message, it responds with a segment containing the following information:</p>

<ul>
	<li><p>The ACK and SYN bits are both set to 1, essentially saying, “Yes, I’m here and I'm listening.”</p></li>
	<li><p>The Acknowledgment number field contains a number that equals the sequence number computer A originally sent, plus 1. As Figure 4-4 illustrates, computer B sends the number 937013559. In this
manner, computer B signals to computer A that it has received the request for communication and further, it expects computer A to respond again with the sequence number 937013559.</p></li>
	<li><p>In its Sequence number field, computer B sends its own seemingly random number (in Figure 4-4, this number is 3043958669).</p></li>
</ul>

<p><b>Step 3</b>, ACK (connection established)—Computer A issues a segment with the following information:</p>

<ul>
	<li><p>The sequence number is 937013559 because this is what computer B indicated it expects to receive.</p></li>
	<li><p>The Acknowledgment number field equals the sequence number that computer B sent, plus 1. In the example, this number is 3043958670.</p></li>
	<li><p>The ACK bit is set to 1.</p></li>
</ul>

<section aria-label="End">
<a href="data_packages.html">«Data Packages</a>
<a href="index.html">Index</a>
<a href="UDP.html">UDP»</a>
</section>

</article>

</body>
</html>
